"use strict";"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="highcharts-ng"),function(){function t(t,n,e){void 0===e&&(e=0),e<0&&(e+=t.length),e<0&&(e=0);for(var i=t.length;e<i;e++)if(e in t&&t[e]===n)return e;return-1}function n(t,n,e){var i=t[n];t[n]=function(){var t=Array.prototype.slice.call(arguments);return e.apply(this,t),i?i.apply(this,t):void 0}}function e(t,n){if(angular.isArray(n)){t=angular.isArray(t)?t:[];for(var i=0;i<n.length;i++)t[i]=e(t[i]||{},n[i])}else if(angular.isObject(n)){t=angular.isObject(t)?t:{};for(var r in n)t[r]=e(t[r]||{},n[r])}else t=n;return t}function i(t,n){function e(){return i}var i=t.when(n.Highcharts);return{getHighcharts:e,ready:function(t,n){e().then(function(){t.call(n)})}}}function r(i,r){function a(n,e,i,a){var o={},c=!1,h=function(n,i){var r,a=[];if(n){if(s(n)&&!e.disableDataWatch)return!1;if(angular.forEach(n,function(t,n){a.push(t.id);var e=c.get(t.id);if(e)if(angular.equals(o[t.id],d(t)))if(void 0!==t.visible&&e.visible!==t.visible&&e.setVisible(t.visible,!1),n<i.length){var r=i[n],s=angular.copy(r),u=t.data[t.data.length-1];s.data.push(u),angular.equals(s,t)?e.addPoint(u,!1):(s.data.shift(),angular.equals(s,t)?e.addPoint(u,!1,!0):e.setData(angular.copy(t.data),!1))}else e.setData(angular.copy(t.data),!1);else e.update(angular.copy(t),!1);else c.addSeries(angular.copy(t),!1);o[t.id]=d(t)}),e.config.noData){var u=!1;for(r=0;r<n.length;r++)if(n[r].data&&n[r].data.length>0){u=!0;break}u?c.hideLoading():c.showLoading(e.config.noData)}}for(r=c.series.length-1;r>=0;r--){var h=c.series[r];"highcharts-navigator-series"!==h.options.id&&t(a,h.options.id)<0&&h.remove(!1)}return!0},v=function(){c&&c.destroy(),o={};var t=e.config||{},r=l(e,i,t),a=t.func||void 0,s=p(e);c=new n[s](r,a);for(var h=0;h<u.length;h++)t[u[h]]&&f(c,t[u[h]],u[h]);t.loading&&c.showLoading(),t.getHighcharts=function(){return c}};v(),e.disableDataWatch?e.$watchCollection("config.series",function(t,n){h(t),c.redraw()}):e.$watch("config.series",function(t,n){h(t,n)&&c.redraw()},!0),e.$watch("config.title",function(t){c.setTitle(t,!0)},!0),e.$watch("config.subtitle",function(t){c.setTitle(!0,t)},!0),e.$watch("config.loading",function(t){t?c.showLoading(!0===t?null:t):c.hideLoading()}),e.$watch("config.noData",function(t){e.config&&e.config.loading&&c.showLoading(t)},!0),e.$watch("config.credits.enabled",function(t){t?c.credits.show():c.credits&&c.credits.hide()}),e.$watch(p,function(t,n){t!==n&&v()}),angular.forEach(u,function(t){e.$watch("config."+t,function(n){if(n){if(angular.isArray(n))for(var e=0;e<n.length;e++){var i=n[e];e<c[t].length&&(c[t][e].update(i,!1),g(c[t][e],angular.copy(i)))}else c[t][0].update(n,!1),g(c[t][0],angular.copy(n));c.redraw()}},!0)}),e.$watch("config.options",function(t,n,e){t!==n&&(v(),h(e.config.series),c.redraw())},!0),e.$watch("config.size",function(t,n){t!==n&&t&&c.setSize(t.width||c.chartWidth,t.height||c.chartHeight)},!0),e.$on("highchartsng.reflow",function(){c.reflow()}),e.$on("$destroy",function(){if(c){try{c.destroy()}catch(t){}r(function(){i.remove()},0)}})}function o(t,n,e){function r(i){a(i,t,n,e)}i.getHighcharts().then(r)}var c=0,s=function(t){var n=!1;return angular.forEach(t,function(t){angular.isDefined(t.id)||(t.id="series-"+c++,n=!0)}),n},u=["xAxis","yAxis"],h={stock:"StockChart",map:"Map",chart:"Chart"},l=function(t,i,a){var o={},c={chart:{events:{}},title:{},subtitle:{},series:[],credits:{},plotOptions:{},navigator:{enabled:!1},xAxis:{events:{}},yAxis:{events:{}}};return o=a.options?e(c,a.options):c,o.chart.renderTo=i[0],angular.forEach(u,function(i){angular.isDefined(a[i])&&(o[i]=e(o[i]||{},a[i]),(angular.isDefined(a[i].currentMin)||angular.isDefined(a[i].currentMax))&&(n(o.chart.events,"selection",function(n){var e=this;n[i]?t.$apply(function(){t.config[i].currentMin=n[i][0].min,t.config[i].currentMax=n[i][0].max}):t.$apply(function(){t.config[i].currentMin=e[i][0].dataMin,t.config[i].currentMax=e[i][0].dataMax})}),n(o.chart.events,"addSeries",function(n){t.config[i].currentMin=this[i][0].min||t.config[i].currentMin,t.config[i].currentMax=this[i][0].max||t.config[i].currentMax}),n(o[i].events,"setExtremes",function(n){n.trigger&&"zoom"!==n.trigger&&r(function(){t.config[i].currentMin=n.min,t.config[i].currentMax=n.max,t.config[i].min=n.min,t.config[i].max=n.max},0)})))}),a.title&&(o.title=a.title),a.subtitle&&(o.subtitle=a.subtitle),a.credits&&(o.credits=a.credits),a.size&&(a.size.width&&(o.chart.width=a.size.width),a.size.height&&(o.chart.height=a.size.height)),o},g=function(t,n){var e=t.getExtremes();n.currentMin===e.dataMin&&n.currentMax===e.dataMax||(t.setExtremes?t.setExtremes(n.currentMin,n.currentMax,!1):t.detachedsetExtremes(n.currentMin,n.currentMax,!1))},f=function(t,n,e){(n.currentMin||n.currentMax)&&t[e][0].setExtremes(n.currentMin,n.currentMax,!0)},d=function(t){return angular.extend(e({},t),{data:null,visible:null})},p=function(t){return void 0===t.config?"Chart":h[(""+t.config.chartType).toLowerCase()]||(t.config.useHighStocks?"StockChart":"Chart")};return{restrict:"EAC",replace:!0,template:"<div></div>",scope:{config:"=",disableDataWatch:"="},link:o}}angular.module("highcharts-ng",[]).factory("highchartsNG",["$q","$window",i]).directive("highchart",["highchartsNG","$timeout",r])}(),function(t){t.module("tubular-hchart.directives",["tubular.services","highcharts-ng"]).component("tbHighcharts",{template:'<div class="tubular-chart"><highchart config="$ctrl.options" ng-hide="$ctrl.isEmpty || $ctrl.hasError"></highchart><div class="alert alert-info" ng-show="$ctrl.isEmpty">{{$ctrl.emptyMessage}}</div><div class="alert alert-warning" ng-show="$ctrl.hasError">{{$ctrl.errorMessage}}</div></div>',bindings:{serverUrl:"@",title:"@?",requireAuthentication:"=?",name:"@?chartName",chartType:"@?",emptyMessage:"@?",errorMessage:"@?",onLoad:"=?",options:"=?",onClick:"=?"},controller:["$scope","$http","$timeout",function(n,e,i){var r=this;r.showLegend=!!t.isUndefined(r.showLegend)||r.showLegend,r.chartType=r.chartType||"line",r.options=t.extend({},r.options,{options:{chart:{type:r.chartType},plotOptions:{pie:{point:{events:{click:r.onClick||t.noop}}},series:{point:{events:{click:r.onClick||t.noop}}}}},title:{text:r.title||""},xAxis:{categories:[]},yAxis:{},series:[]}),r.requireAuthentication=!!t.isUndefined(r.requireAuthentication)||r.requireAuthentication,r.loadData=function(){r.hasError=!1,e.get(r.serverUrl,{requireAuthentication:r.requireAuthentication}).then(r.handleData,function(t){n.$emit("tbChart_OnConnectionError",t),r.hasError=!0})},r.handleData=function(t){var n=t.data;if(!n||!n.Data||0===n.Data.length)return r.isEmpty=!0,r.options.series=[{data:[]}],void(r.onLoad&&r.onLoad(r.options,{}));if(r.isEmpty=!1,n.Series)r.options.xAxis.categories=n.Labels,r.options.series=n.Series.map(function(t,e){return{name:t,data:n.Data[e]}});else{var e=n.Labels.map(function(t,e){return{name:t,y:n.Data[e]}});r.options.series=[{name:n.SerieName||"",data:e,showInLegend:""!==(n.SerieName||"")}]}r.onLoad&&(i(function(){return r.onLoad(r.options,{},r.options.getHighcharts().series)},100),r.onLoad(r.options,{},null))},n.$watch("$ctrl.serverUrl",function(n){t.isDefined(n)&&null!=n&&""!==n&&r.loadData()}),n.$watch("$ctrl.chartType",function(n){t.isDefined(n)&&null!=n&&(r.options.options.chart.type=n)})}]})}(angular);